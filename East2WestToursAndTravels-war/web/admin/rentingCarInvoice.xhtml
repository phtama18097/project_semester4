<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:jsf="http://xmlns.jcp.org/jsf"
                template="mainLayout.xhtml">

    <ui:define name="subheader">

        <div class="d-flex align-items-center flex-wrap mr-2">
            <h5 class="text-dark font-weight-bold my-1 mr-5">Car Registration Detail</h5>
            <ul class="breadcrumb breadcrumb-transparent breadcrumb-dot font-weight-bold p-0 my-2 font-size-sm">
                <li class="breadcrumb-item">
                    <a href="" class="text-muted">Home</a>
                </li>
                <li class="breadcrumb-item">
                    <a href="#{request.contextPath}/faces/admin/manageCarRegistration.xhtml" class="text-muted">Manage Car Registration</a>
                </li>
                <li class="breadcrumb-item">
                    <a href="javascript:0;" class="text-muted">Car Registration Detail</a>
                </li>
            </ul>
        </div>

        <div class="d-flex align-items-center">
            <div class="dropdown dropdown-inline mr-2">
                <button type="button" class="btn btn-light-success font-weight-bolder dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span class="svg-icon svg-icon-md">
                        <svg   width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                            <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                <rect x="0" y="0" width="24" height="24" />
                                <path d="M3,16 L5,16 C5.55228475,16 6,15.5522847 6,15 C6,14.4477153 5.55228475,14 5,14 L3,14 L3,12 L5,12 C5.55228475,12 6,11.5522847 6,11 C6,10.4477153 5.55228475,10 5,10 L3,10 L3,8 L5,8 C5.55228475,8 6,7.55228475 6,7 C6,6.44771525 5.55228475,6 5,6 L3,6 L3,4 C3,3.44771525 3.44771525,3 4,3 L10,3 C10.5522847,3 11,3.44771525 11,4 L11,19 C11,19.5522847 10.5522847,20 10,20 L4,20 C3.44771525,20 3,19.5522847 3,19 L3,16 Z" fill="#000000" opacity="0.3" />
                                <path d="M16,3 L19,3 C20.1045695,3 21,3.8954305 21,5 L21,15.2485298 C21,15.7329761 20.8241635,16.200956 20.5051534,16.565539 L17.8762883,19.5699562 C17.6944473,19.7777745 17.378566,19.7988332 17.1707477,19.6169922 C17.1540423,19.602375 17.1383289,19.5866616 17.1237117,19.5699562 L14.4948466,16.565539 C14.1758365,16.200956 14,15.7329761 14,15.2485298 L14,5 C14,3.8954305 14.8954305,3 16,3 Z" fill="#000000" />
                            </g>
                        </svg>
                    </span>Actions</button>
                <div class="dropdown-menu dropdown-menu-sm dropdown-menu-right">
                    <ul class="navi flex-column navi-hover py-2">
                        <li class="navi-header font-weight-bolder text-uppercase font-size-sm text-primary pb-2">Choose an option:</li>
                        <c:if test="#{carRegistrationMB.carRegistration.status == 0}">
                            <li class="navi-item">
                                <a onclick="$('#btnApprove').click();" style="cursor: pointer" class="navi-link">
                                    <span class="navi-icon">
                                        <i class="flaticon2-accept"></i>
                                    </span>
                                    <span class="navi-text">Approve Renting</span>
                                </a>
                            </li>
                            <li class="navi-item">
                                <a onclick="$('#btnDecline').click();" style="cursor: pointer" class="navi-link">
                                    <span class="navi-icon">
                                        <i class="flaticon2-cancel-music"></i>
                                    </span>
                                    <span class="navi-text">Decline Renting</span>
                                </a>
                            </li>
                        </c:if>
                        <c:if test="#{carRegistrationMB.carRegistration.status == 1}">
                            <li class="navi-item">
                                <a onclick="$('#btnReturn').click();" style="cursor: pointer" class="navi-link">
                                    <span class="navi-icon">
                                        <i class="flaticon2-delivery-truck"></i>
                                    </span>
                                    <span class="navi-text">Return Car</span>
                                </a>
                            </li>
                        </c:if>
                        <li class="navi-item">
                            <a href="#" class="navi-link">
                                <span class="navi-icon">
                                    <i class="la la-print"></i>
                                </span>
                                <span class="navi-text">Print</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <a href="#{request.contextPath}/faces/admin/manageCarRegistration.xhtml" class="btn btn-light-primary font-weight-bolder">
                <span class="svg-icon svg-icon-md">
                    <svg   width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <polygon points="0 0 24 0 24 24 0 24"/>
                            <rect fill="#000000" opacity="0.3" transform="translate(14.000000, 12.000000) rotate(-90.000000) translate(-14.000000, -12.000000) " x="13" y="5" width="2" height="14" rx="1"/>
                            <rect fill="#000000" opacity="0.3" x="3" y="3" width="2" height="18" rx="1"/>
                            <path d="M11.7071032,15.7071045 C11.3165789,16.0976288 10.6834139,16.0976288 10.2928896,15.7071045 C9.90236532,15.3165802 9.90236532,14.6834152 10.2928896,14.2928909 L16.2928896,8.29289093 C16.6714686,7.914312 17.281055,7.90106637 17.675721,8.26284357 L23.675721,13.7628436 C24.08284,14.136036 24.1103429,14.7686034 23.7371505,15.1757223 C23.3639581,15.5828413 22.7313908,15.6103443 22.3242718,15.2371519 L17.0300721,10.3841355 L11.7071032,15.7071045 Z" fill="#000000" fill-rule="nonzero" transform="translate(16.999999, 11.999997) scale(1, -1) rotate(90.000000) translate(-16.999999, -11.999997) "/>
                        </g>
                    </svg>
                </span>Back
            </a>
        </div>
        <h:form style="display: none">
            <h:commandButton p:id="btnApprove" action="#{carRegistrationMB.updateStatus(carRegistrationMB.carRegistration.registrationId, 1)}" style="display: none"/>
            <h:commandButton p:id="btnDecline" action="#{carRegistrationMB.updateStatus(carRegistrationMB.carRegistration.registrationId, 3)}" style="display: none"/>
            <h:commandButton p:id="btnReturn" action="#{carRegistrationMB.returnCar(carRegistrationMB.carRegistration.registrationId)}" style="display: none"/>
        </h:form>
    </ui:define>

    <ui:define name="content">
        <div class="d-flex flex-row">
            <div class="flex-row-auto offcanvas-mobile w-300px w-xl-350px" id="kt_profile_aside">
                <div class="card card-custom card-stretch">
                    <div class="card-body pt-4">
                        <div class="d-flex justify-content-end">
                            <div class="dropdown dropdown-inline">
                                <a href="#" class="btn btn-clean btn-hover-light-primary btn-sm btn-icon" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="ki ki-bold-more-hor"></i>
                                </a>
                            </div>
                        </div>
                        <div class="d-flex align-items-center">
                            <div class="symbol symbol-60 symbol-xxl-100 mr-5 align-self-start align-self-xxl-center">
                                <div class="symbol-label" style="background-image:url('#{request.contextPath}/uploads/imgCustomers/#{carRegistrationMB.carRegistration.customerId.avatar}')"></div>
                            </div>
                            <div>
                                <a href="#" class="font-weight-bolder font-size-h5 text-dark-75 text-hover-primary"><h:outputText value="#{carRegistrationMB.carRegistration.customerId.firstName}" /><h:outputText value=" #{carRegistrationMB.carRegistration.customerId.lastName}" /></a>
                                <div class="text-muted">
                                    <c:if test="#{carRegistrationMB.carRegistration.customerId.gender}">
                                        <h:outputText value="Male"/>
                                    </c:if>
                                    <c:if test="#{!carRegistrationMB.carRegistration.customerId.gender}">
                                        <h:outputText value="Female"/>
                                    </c:if>
                                </div>
                                <div class="text-muted">
                                    <h:outputText value="#{carRegistrationMB.carRegistration.customerId.birthDate}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>
                                </div>
                            </div>
                        </div>
                        <div class="py-9">
                            <div style="padding-bottom: 5%" class="d-flex align-items-center justify-content-between mb-2">
                                <span class="font-weight-bold mr-2">Email:</span>
                                <a href="#" class="text-muted text-hover-primary"><h:outputText value="#{carRegistrationMB.carRegistration.customerId.email}"/></a>
                            </div>
                            <div style="padding-bottom: 5%" class="d-flex align-items-center justify-content-between mb-2">
                                <span class="font-weight-bold mr-2">Phone:</span>
                                <span class="text-muted"><h:outputText value="#{carRegistrationMB.carRegistration.customerId.phone}"/></span>
                            </div>
                            <div style="padding-bottom: 5%" class="d-flex align-items-center justify-content-between">
                                <span class="font-weight-bold mr-2">Address:</span>
                                <span class="text-muted"><h:outputText value="#{carRegistrationMB.carRegistration.customerId.address}"/></span>
                            </div>
                            <div style="padding-bottom: 5%" class="d-flex align-items-center justify-content-between">
                                <span class="font-weight-bold mr-2">Registration Date:</span>
                                <span class="text-muted"><h:outputText value="#{carRegistrationMB.toDateTime(carRegistrationMB.carRegistration.registrationDate)}"/></span>
                            </div>
                            <div style="padding-bottom: 5%" class="d-flex align-items-center justify-content-between">
                                <span class="font-weight-bold mr-2">Return Date:</span>
                                <span class="text-muted">
                                    <h:outputText rendered="#{carRegistrationMB.carRegistration.status == 3}" class="label label-lg font-weight-bold label-light-danger label-inline" value="canceled"/>  
                                    <h:outputText rendered="#{carRegistrationMB.carRegistration.status == 0}" class="label label-lg font-weight-bold label-light-info label-inline" value="pending"/>
                                    <h:outputText rendered="#{carRegistrationMB.carRegistration.status == 1}" class="label label-lg font-weight-bold label-light-primary label-inline" value="renting"/>
                                    <h:outputText rendered="#{carRegistrationMB.carRegistration.returnDate != null}" value="#{carRegistrationMB.toDateTime(carRegistrationMB.carRegistration.returnDate)}"/>
                                </span>
                            </div>
                            <div style="padding-bottom: 5%" class="d-flex align-items-center justify-content-between">
                                <span class="font-weight-bold mr-2">Total:</span>
                                <span class="text-muted"><h:outputText class="label label-lg font-weight-bold label-light label-inline" value="#{carRegistrationMB.carRegistration.total}"><f:convertNumber pattern="#,### ¤" currencySymbol="₫" /></h:outputText></span>
                            </div>
                            <div style="padding-bottom: 5%" class="d-flex align-items-center justify-content-between">
                                <span class="font-weight-bold mr-2">Payment:</span>
                                <span class="text-muted"><h:outputText value="#{carRegistrationMB.carRegistration.methodId.methodName}"/></span>
                            </div>
                            <div style="padding-bottom: 5%" class="d-flex align-items-center justify-content-between">
                                <span class="font-weight-bold mr-2">Status:</span>
                                <span class="text-muted">
                                    <h:outputText rendered="#{carRegistrationMB.carRegistration.status == 3}" class="label label-lg font-weight-bold label-light-danger label-inline" value="canceled"/>
                                    <h:outputText rendered="#{carRegistrationMB.carRegistration.status == 0}" class="label label-lg font-weight-bold label-light-info label-inline" value="pending" />
                                    <h:outputText rendered="#{carRegistrationMB.carRegistration.status == 1}" class="label label-lg font-weight-bold label-light-primary label-inline" value="renting"/>
                                    <h:outputText rendered="#{carRegistrationMB.carRegistration.status == 2}" class="label label-lg font-weight-bold label-light-success label-inline" value="success" />
                                </span>
                            </div>
                            <div class="d-flex align-items-center justify-content-between">
                                <span class="font-weight-bold mr-2">Note:</span>
                                <span class="text-muted"><h:outputText value="#{carRegistrationMB.carRegistration.note}"/></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex-row-fluid ml-lg-8">
                <div class="card card-custom gutter-b">
                    <div class="card-header border-0 pt-5">
                        <h3 class="card-title align-items-start flex-column">
                            <span class="card-label font-weight-bolder text-dark">Car List</span>
                            <span class="text-muted mt-3 font-weight-bold font-size-sm">Customer's rented car</span>
                        </h3>
                    </div>
                    <div class="card-body pt-2 pb-0 mt-n3">
                        <h:dataTable value="#{carRegistrationMB.detailList}" var="item" class="table table-separate table-head-custom table-checkable" id="table-admin" >
                            <h:column>
                                <f:facet name="header"><h:outputText value="Licence Plate"/></f:facet>
                                <h:outputText value="#{carRegistrationMB.showCarLicencePlate(item.carRegistrationDetailsPK.carId)}"/>
                            </h:column>
                            <h:column>
                                <f:facet name="header"><h:outputText value="Name"/></f:facet>
                                <div class="d-flex align-items-center">
                                    <div class="symbol symbol-50 flex-shrink-0">
                                        <h:graphicImage value="/uploads/imgCars/#{carRegistrationMB.showCarThumbnail(item.carRegistrationDetailsPK.carId)}" alt="thumbnail"/> 
                                    </div>
                                    <div class="ml-3">
                                        <span class="text-dark-75 font-weight-bold line-height-sm d-block pb-2"><h:outputText value="#{carRegistrationMB.showCarName(item.carRegistrationDetailsPK.carId)}"/></span>
                                    </div>
                                </div>
                            </h:column>
                            <h:column>
                                <f:facet name="header"><h:outputText value="Quantity"/></f:facet>
                                <h:outputText value="#{item.quantity}"  />    
                            </h:column>
                            <h:column>
                                <f:facet name="header"><h:outputText value="Unit Price"/></f:facet>
                                <h:outputText value="#{item.unitPrice}" class="label label-lg font-weight-bold label-light label-inline">
                                    <f:convertNumber pattern="#,### ¤" currencySymbol="₫" />
                                </h:outputText>
                            </h:column>

                        </h:dataTable>
                        <div style="padding-bottom: 2%"></div>
                    </div>
                </div>
            </div>
        </div>
    </ui:define>
    <ui:define name="myScript">
        <script>
            #{carRegistrationMB.notice}
            #{carRegistrationMB.notice = ""}
        </script>
    </ui:define>

</ui:composition>
